class ChiCuadradaTable {
  static const Map<int, Map<double, double>> _table = {
    // DF: {P: value}
    1: {0.995: 0.0000393, 0.975: 0.000982, 0.05: 3.841, 0.025: 5.024, 0.01: 6.635},
    2: {0.995: 0.0100, 0.975: 0.0506, 0.05: 5.991, 0.025: 7.378, 0.01: 9.210},
    3: {0.995: 0.0717, 0.975: 0.216, 0.05: 7.815, 0.025: 9.348, 0.01: 11.345},
    4: {0.995: 0.207, 0.975: 0.484, 0.05: 9.488, 0.025: 11.143, 0.01: 13.277},
    5: {0.995: 0.412, 0.975: 0.831, 0.05: 11.070, 0.025: 12.833, 0.01: 15.086},
    6: {0.995: 0.676, 0.975: 1.237, 0.05: 12.592, 0.025: 14.449, 0.01: 16.812},
    7: {0.995: 0.989, 0.975: 1.690, 0.05: 14.067, 0.025: 16.013, 0.01: 18.475},
    8: {0.995: 1.344, 0.975: 2.180, 0.05: 15.507, 0.025: 17.535, 0.01: 20.090},
    9: {0.995: 1.735, 0.975: 2.700, 0.05: 16.919, 0.025: 19.023, 0.01: 21.666},
    10: {0.995: 2.156, 0.975: 3.247, 0.05: 18.307, 0.025: 20.483, 0.01: 23.209},
    11: {0.995: 2.603, 0.975: 3.816, 0.05: 19.675, 0.025: 21.920, 0.01: 24.725},
    12: {0.995: 3.074, 0.975: 4.404, 0.05: 21.026, 0.025: 23.337, 0.01: 26.217},
    13: {0.995: 3.565, 0.975: 5.009, 0.05: 22.362, 0.025: 24.736, 0.01: 27.688},
    14: {0.995: 4.075, 0.975: 5.629, 0.05: 23.685, 0.025: 26.119, 0.01: 29.141},
    15: {0.995: 4.601, 0.975: 6.262, 0.05: 24.996, 0.025: 27.488, 0.01: 30.578},
    16: {0.995: 5.142, 0.975: 6.908, 0.05: 26.296, 0.025: 28.845, 0.01: 32.000},
    17: {0.995: 5.697, 0.975: 7.564, 0.05: 27.587, 0.025: 30.191, 0.01: 33.409},
    18: {0.995: 6.265, 0.975: 8.231, 0.05: 28.869, 0.025: 31.526, 0.01: 34.805},
    19: {0.995: 6.844, 0.975: 8.907, 0.05: 30.144, 0.025: 32.852, 0.01: 36.191},
    20: {0.995: 7.434, 0.975: 9.591, 0.05: 31.410, 0.025: 34.170, 0.01: 37.566},
    21: {0.995: 8.034, 0.975: 10.283, 0.05: 32.671, 0.025: 35.479, 0.01: 38.932},
    22: {0.995: 8.643, 0.975: 10.982, 0.05: 33.924, 0.025: 36.781, 0.01: 40.289},
    23: {0.995: 9.260, 0.975: 11.689, 0.05: 35.172, 0.025: 38.076, 0.01: 41.638},
    24: {0.995: 9.886, 0.975: 12.401, 0.05: 36.415, 0.025: 39.364, 0.01: 42.980},
    25: {0.995: 10.520, 0.975: 13.120, 0.05: 37.652, 0.025: 40.646, 0.01: 44.314},
    26: {0.995: 11.160, 0.975: 13.844, 0.05: 38.885, 0.025: 41.923, 0.01: 45.642},
    27: {0.995: 11.808, 0.975: 14.573, 0.05: 40.113, 0.025: 43.195, 0.01: 46.963},
    28: {0.995: 12.461, 0.975: 15.308, 0.05: 41.337, 0.025: 44.461, 0.01: 48.278},
    29: {0.995: 13.121, 0.975: 16.047, 0.05: 42.557, 0.025: 45.722, 0.01: 49.588},
    30: {0.995: 13.787, 0.975: 16.791, 0.05: 43.773, 0.025: 46.979, 0.01: 50.892},
    40: {0.995: 20.707, 0.975: 24.433, 0.05: 55.758, 0.025: 59.342, 0.01: 63.691},
    50: {0.995: 27.991, 0.975: 32.357, 0.05: 67.505, 0.025: 71.420, 0.01: 76.154},
    60: {0.995: 35.534, 0.975: 40.482, 0.05: 79.082, 0.025: 83.298, 0.01: 88.379},
    70: {0.995: 43.275, 0.975: 48.758, 0.05: 90.531, 0.025: 95.023, 0.01: 100.425},
    80: {0.995: 51.172, 0.975: 57.153, 0.05: 101.879, 0.025: 106.629, 0.01: 112.329},
    90: {0.995: 59.196, 0.975: 65.647, 0.05: 113.145, 0.025: 118.136, 0.01: 124.116},
    100: {0.995: 67.328, 0.975: 74.222, 0.05: 124.342, 0.025: 129.561, 0.01: 135.807},
  };

  static double lookup(double p, int df) {
    if (_table.containsKey(df) && _table[df].containsKey(p)) {
      return _table[df][p];
    }
    // Simple interpolation for df values not in the table
    if (df > 100) {
      // For large df, chi-squared distribution approaches normal
      // This is a simplification and may not be accurate for all cases
      return df * pow(1 - 2 / (9 * df) + _getZ(p) * sqrt(2 / (9 * df)), 3);
    }
    return null;
  }

  static double _getZ(double alpha) {
    if (alpha <= 0.01) return 2.58;
    if (alpha <= 0.02) return 2.33;
    if (alpha <= 0.05) return 1.96;
    if (alpha <= 0.1) return 1.645;
    return 1.96; // Default for 95%
  }
}
